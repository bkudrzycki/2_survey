***********************************************************************
*************************  Reshape to Panel  **************************
***********************************************************************

clear all
use "$WorkingData/youth_survey_merged.dta"

* drop firm survey data
drop FS* A*

* fix some type matching problems
quietly destring, replace

global varlist "YS_ResponseId YS_duration YS_LocationLatitude YS_LocationLongitude YS_StartDate YS_EndDate YS_RecordedDate YSstatus YS1_1 YS1_2 YS1_3 YS2_9_1 YS2_9_8 YS2_9_2 YS2_10_1_1 YS2_10_2_1 YS2_10_3_1 YS8_1 YS8_2 YS8_5 YS8_3 YS8_3_13_TEXT YS8_3_14_TEXT YS8_4 YS8_4_8_TEXT YS8_5_9_TEXT YS8_9 YS8_10 YS8_11 YS8_13 YS8_13_7_TEXT YS8_14 YS8_14_7_TEXT YS8_17 YS8_18 YS8_19 YS8_20 YS8_21 YS8_22 YS8_23 YS8_24 YS8_25 YS8_27 YS8_28 YS8_33 YS8_34_1 YS8_34_2 YS8_34_3 YS8_34_4 YS8_34_5 YS8_34_6 YS8_34_7 YS8_34_8 YS8_34_8_TEXT YS8_35 YS8_36 YS8_36_9_TEXT YS4_1 YS4_2 YS4_2_4_TEXT YS4_3 YS4_3_6_TEXT YS4_4 YS4_5 YS4_8_1 YS4_8_2 YS4_8_3 YS4_8_4 YS4_8_5 YS4_8_6 YS4_8_7 YS4_8_8 YS4_8_9 YS4_8_9_TEXT YS4_10 YS4_11 YS4_12 YS4_15 YS4_28_1 YS4_28_2 YS4_28_3 YS4_28_4 YS4_28_5 YS4_28_6 YS4_28_6_TEXT YS4_36_1 YS4_36_2 YS4_36_3 YS4_36_4 YS4_36_5 YS4_36_6 YS4_36_0 YS4_36_6_TEXT YS4_37_1 YS4_37_2 YS4_37_3 YS4_37_4 YS4_37_5 YS4_37_0 YS4_38 YS4_41 YS4_42_1 YS4_42_2 YS4_42_3 YS4_42_4 YS4_42_5 YS4_42_6 YS4_42_7 YS4_42_7_TEXT YS4_47 YS4_47_13_TEXT YS4_43 YS4_44 YS4_51 YS4_52_1 YS4_52_2 YS4_52_3 YS4_52_4 YS4_52_5 YS4_52_6 YS4_52_7 YS4_52_8 YS4_52_9 YS4_52_9_TEXT YS4_53 YS4_53_8_TEXT YS6_19 YS6_21 YS6_16_1 YS6_16_2 YS6_16_3 YS6_16_4 YS6_16_5 YS6_16_6 YS6_16_7 YS9_1 YS9_4 YS9_4_7_TEXT YS9_6 YS9_6_10_TEXT YS9_7 YS9_8_1 YS9_8_2 YS9_8_3 YS9_8_4 YS9_8_5 YS9_8_6 YS9_9_1 YS9_9_2 YS9_9_3 YS9_9_4 YS9_9_5 YS9_9_0 YS9_9_5_TEXT YS9_11_1 YS9_11_2 YS9_11_3 YS9_11_4 YS9_11_5 YS9_11_5_TEXT YS9_12 YS9_13 YS9_14 YS9_15 YS9_24 YS9_23 YS9_29_1 YS9_29_2 YS9_29_3 YS9_29_4 YS9_29_5 YS9_29_6 YS9_31 YS9_33 YS9_36 YS9_34 YS9_35_1 YS9_35_2 YS9_35_3 YS9_35_4 YS9_35_5 YS9_35_6 YS9_35_7 YS9_35_7_TEXT YS9_37  YS9_37_6_TEXT YS10_1 YS10_2 YS10_3 YS10_3_8_TEXT YS10_6 YS10_7 YS10_7_10_TEXT YS10_8 YS10_20 YS10_20_6_TEXT YS10_15_1 YS10_15_2 YS10_15_3 YS10_15_4 YS10_15_5 YS10_15_6 YS10_15_7 YS10_15_8 YS10_15_9 YS10_15_10 YS10_15_11 YS10_15_12 YS10_15_13 YS10_15_14 YS10_15_0 YS10_15_14_TEXT YS10_10_1 YS10_10_2 YS10_10_3 YS10_10_4 YS10_10_5 YS10_10_6 YS10_10_7 YS10_10_8 YS10_10_9 YS10_10_10 YS10_10_11 YS10_10_11_TEXT YS10_11 YS10_12 YS10_19 YS10_16 YS10_17_1 YS10_17_2 YS10_17_3 YS10_17_4 YS10_17_5 YS10_17_6 YS10_17_7 YS10_17_8 YS10_17_9 YS10_17_10 YS10_17_11 YS10_17_11_TEXT YS10_24 YS10_24_16_TEXT YS10_21 YS10_25 YS10_25_9_TEXT YS10_26 YS10_26_9_TEXT YS10_27 YS10_27_7_TEXT YS7_1 YS7_2 YS7_2_9_TEXT YS7_3 YS7_3_11_TEXT YS3_2_1 YS3_2_2 YS3_7 YS3_13 YS3_18_1 YS3_18_2 YS3_18_3 YS3_18_4 YS3_18_5 YS3_18_6 YS3_18_7 YS3_18_8 YS3_18_9 YS3_18_9_TEXT YS7_6 YS7_7 YS7_8_1 YS7_8_2 YS7_8_3 YS7_8_4 YS7_8_5 YS7_8_6 YS7_8_7 YS7_8_8 YS7_8_8_TEXT YS7_13_0 YS7_13_1 YS7_13_2 YS7_13_3 YS7_13_4 YS7_13_5 YS7_13_5_TEXT YS7_14 YS7_15 YS7_15_8_TEXT YS7_16 YS7_17_1 YS7_17_2 YS7_17_3 YS7_17_4 YS7_17_5 YS7_17_6 YS7_17_7 YS7_17_8 YS7_17_9 YS7_17_9_TEXT YS7_18 YS7_19_1 YS7_19_2 YS7_19_3 YS7_19_4 YS7_19_5 YS7_19_6 YS7_19_6_TEXT YS7_22 YS7_22_8_TEXT"

local vallist "YS1_1 YS1_2 YS8_1 YS8_2 YS8_5 YS8_3 YS8_4 YS8_9 YS8_10 YS8_11 YS8_13 YS8_14 YS8_17 YS8_18 YS8_19 YS8_20 YS8_21 YS8_22 YS8_23 YS8_24 YS8_25 YS8_27 YS8_28 YS8_33 YS8_35 YS8_36 YS4_1 YS4_2 YS4_3 YS4_4 YS4_5 YS4_10 YS4_11 YS4_12 YS4_38 YS4_41  YS4_47 YS4_43 YS4_44 YS4_51 YS4_53 YS6_19 YS6_21 YS9_1 YS9_4 YS9_7 YS9_12 YS9_13 YS9_14 YS9_15 YS9_24 YS9_23 YS9_31 YS9_33 YS9_36 YS9_34 YS9_37 YS10_1 YS10_2 YS10_3 YS10_6 YS10_7 YS10_8 YS10_20 YS10_11 YS10_12 YS10_19 YS10_16 YS10_24 YS10_21 YS10_25 YS10_26 YS10_27 YS7_1 YS7_2 YS7_3 YS7_6 YS7_7 YS7_14 YS7_15 YS7_16 YS7_18 YS7_22"

foreach v of global varlist {
    local var_lbl`v': var label `v'
}

foreach v of local vallist {
	local `v': value label `v'
}

rename (F1U1_2 F1U1_9* F1U1_11* F1U1_14 F1U1_15 F1U1_16 F1U1_16_9_TEXT F1U1_17*)(F1U1_3 F1U2_9* F1U2_10* F1U8_1 F1U8_2 F1U8_5 F1U8_5_9_TEXT F1U8_3*)

rename (F2U1_2	F2U1_3_1	F2U1_3_8	F2U1_3_2	F2U1_3a	F2U1_14	F2U1_15	F2U1_16 F2U1_16_9_TEXT	F2U1_17*)(F2U1_3	F2U2_9_1	F2U2_9_8	F2U2_9_2	F2U1_2	F2U8_1	F2U8_2 F2U8_5	F2U8_5_9_TEXT	F2U8_3*)

rename (F3U1_2	F3U1_3_1	F3U1_3_8	F3U1_3_2	F3U1_3a	F3U1_14	F3U1_15	F3U1_16	F3U1_16_9_TEXT	F3U1_17*)(F3U1_3	F3U2_9_1	F3U2_9_8	F3U2_9_2	F3U1_2	F3U8_1	F3U8_2	F3U8_5	F3U8_5_9_TEXT	F3U8_3*)


rename (F1U4_1	F1U4_1_8_TEXT	F1U4_10	F1U4_11	F1U4_12	F1U4_13	F1U4_14	F1U4_15	F1U4_16	F1U4_17	F1U4_18	F1U4_19	F1U4_20*	F1U4_21	F1U4_22*	F1U4_3	F1U4_4	F1U4_5	F1U4_6	F1U4_6_7_TEXT	F1U4_7	F1U4_7_7_TEXT	F1U4_8	F1U4_9)(F1U8_4	F1U8_4_8_TEXT	F1U8_19	F1U8_20	F1U8_21	F1U8_22	F1U8_23	F1U8_24	F1U8_25	F1U8_27	F1U8_28	F1U8_33	F1U8_34*	F1U8_35	F1U8_36*	F1U8_9	F1U8_10	F1U8_11	F1U8_13	F1U8_13_7_TEXT	F1U8_14	F1U8_14_7_TEXT	F1U8_17	F1U8_18)

rename (F2U4_1	F2U4_1_8_TEXT	F2U4_10	F2U4_11	F2U4_12	F2U4_13	F2U4_14	F2U4_15	F2U4_19	F2U4_20*	F2U4_21	F2U4_3	F2U4_4	F2U4_5	F2U4_6	F2U4_6_7_TEXT	F2U4_7	F2U4_7_7_TEXT	F2U4_8	F2U4_9)(F2U8_4	F2U8_4_8_TEXT	F2U8_19	F2U8_20	F2U8_21	F2U8_22	F2U8_23	F2U8_24	F2U8_33	F2U8_34*	F2U8_35	F2U8_9	F2U8_10	F2U8_11	F2U8_13	F2U8_13_7_TEXT	F2U8_14	F2U8_14_7_TEXT	F2U8_17	F2U8_18)

rename (F3U4_1	F3U4_1_8_TEXT	F3U4_10	F3U4_11	F3U4_12	F3U4_13	F3U4_14	F3U4_15	F3U4_19	F3U4_20*	F3U4_21	F3U4_3	F3U4_4	F3U4_5	F3U4_6	F3U4_6_7_TEXT	F3U4_7	F3U4_7_7_TEXT	F3U4_8	F3U4_9) (F3U8_4	F3U8_4_8_TEXT	F3U8_19	F3U8_20	F3U8_21	F3U8_22	F3U8_23	F3U8_24	F3U8_33	F3U8_34*	F3U8_35	F3U8_9	F3U8_10	F3U8_11	F3U8_13	F3U8_13_7_TEXT	F3U8_14	F3U8_14_7_TEXT	F3U8_17	F3U8_18)

rename (F1U2_1	F1U2_10	F1U2_13*	F1U2_14*	F1U2_15*	F1U2_16	F1U2_17	F1U2_18*	F1U2_21*	F1U2_22	F1U2_23	F1U2_24	F1U2_25*	F1U2_26*	F1U2_3	F1U2_3_4_TEXT	F1U2_4	F1U2_4_6_TEXT	F1U2_5*	F1U2_6	F1U2_7	F1U2_8	F1U2_9	F1U4_2)(F1U4_1	F1U4_12	F1U4_28*	F1U4_36*	F1U4_37*	F1U4_38	F1U4_41	F1U4_42*	F1U4_47*	F1U4_43	F1U4_44	F1U4_51	F1U4_52*	F1U4_53*	F1U4_2	F1U4_2_4_TEXT	F1U4_3	F1U4_3_6_TEXT	F1U4_8*	F1U4_4	F1U4_5	F1U4_10	F1U4_11	F1U4_2_suivi)

rename (F2U2_1	F2U2_10	F2U2_14*	F2U2_15*	F2U2_16	F2U2_17	F2U2_18*	F2U2_21*	F2U2_22	F2U2_23	F2U2_4	F2U2_4_6_TEXT	F2U2_6	F2U2_7	F2U2_8	F2U2_9 F2U2_5a)(F2U4_1	F2U4_12	F2U4_36*	F2U4_37*	F2U4_38	F2U4_41	F2U4_42*	F2U4_47*	F2U4_43	F2U4_44	F2U4_3	F2U4_3_6_TEXT	F2U4_4	F2U4_5	F2U4_10	F2U4_11 F2U4_15)

rename (F2U2_5*)(F2U4_8*)

rename (F3U2_1a	F3U2_10	F3U2_14*	F3U2_15*	F3U2_16	F3U2_17	F3U2_18*	F3U2_21*	F3U2_22	F3U2_23	F3U2_4 F3U2_4_6_TEXT	F3U2_6	F3U2_7	F3U2_8	F3U2_9 F3U2_5a F3U4_2 F3U2_2a*)(F3U4_1	F3U4_12	F3U4_36*	F3U4_37*	F3U4_38	F3U4_41	F3U4_42*	F3U4_47*	F3U4_43	F3U4_44	F3U4_3	F3U4_3_6_TEXT	F3U4_4	F3U4_5	F3U4_10	F3U4_11 F3U4_15 F3U4_2new F3U4_2*)

rename (F3U2_5*)(F3U4_8*)

rename (F1U3_1	F1U3_2	F1U5_1	F1U5_10	F1U5_11	F1U5_12	F1U5_13	F1U5_14	F1U5_15*	F1U5_16	F1U5_17	F1U5_18	F1U5_19	F1U5_20*	F1U5_21*	F1U5_3*	F1U5_4*	F1U5_5	F1U5_6*	F1U5_7*	F1U5_8*	F1U5_9)(F1U6_19	F1U6_21	F1U9_1	F1U9_13	F1U9_14	F1U9_15	F1U9_24	F1U9_23	F1U9_29*	F1U9_31	F1U9_33	F1U9_36	F1U9_34	F1U9_35*	F1U9_37*	F1U9_4*	F1U9_6*	F1U9_7	F1U9_8*	F1U9_9*	F1U9_11*	F1U9_12)

rename F2U6_16* F2U7_22*

rename (F2U3_0a* F2U3_1	F2U3_2	F2U5_1	F2U5_10	F2U5_11	F2U5_12	F2U5_13	F2U5_14	F2U5_15*	F2U5_18	F2U5_19	F2U5_20* F2U5_3*	F2U5_4*	F2U5_5	F2U5_6*	F2U5_7*	F2U5_8*	F2U5_9)(F2U6_16*	F2U6_19	F2U6_21	F2U9_1	F2U9_13	F2U9_14	F2U9_15	F2U9_24	F2U9_23	F2U9_29* F2U9_36	F2U9_34	F2U9_35*	F2U9_4*	F2U9_6*	F2U9_7	F2U9_8*	F2U9_9*	F2U9_11* F2U9_12)

rename (F3U3_1	F3U3_2	F3U3_7	F3U3_2a	F3U5_1	F3U1_12*	F3U3_6	F3U5_10	F3U5_11	F3U5_12	F3U5_13	F3U5_14	F3U5_15*	F3U5_18	F3U5_19	F3U5_20*	F3U5_3*	F3U5_4*	F3U5_5	F3U5_6*	F3U5_7*	F3U5_8*	F3U5_9)(F3U6_19	F3U6_21	F3U3_7_new	F3U3_7	F3U9_1	F3U3_2*	F3U3_13	F3U9_13	F3U9_14	F3U9_15	F3U9_24	F3U9_23	F3U9_29*	F3U9_36	F3U9_34	F3U9_35*	F3U9_4*	F3U9_6*	F3U9_7	F3U9_8*	F3U9_9*	F3U9_11*	F3U9_12)

rename (F1U7_1	F1U7_10	F1U7_11	F1U7_12	F1U7_13	F1U7_14*	F1U7_15*	F1U7_16	F1U7_17*	F1U7_18*	F1U7_19*	F1U7_2	F1U7_3*	F1U7_4	F1U7_5*	F1U7_6	F1U7_7*	F1U7_8*	F1U7_9*) (F1U10_1	F1U10_11	F1U10_12	F1U10_19	F1U10_16	F1U10_17*	F1U10_24*	F1U10_21	F1U10_25*	F1U10_26*	F1U10_27*	F1U10_2	F1U10_3*	F1U10_6	F1U10_7*	F1U10_8	F1U10_20*	F1U10_15*	F1U10_10*)

rename (F2U7_1	F2U7_10	F2U7_12	F2U7_13	F2U7_14*	F2U7_15*	F2U7_16	F2U7_17*	F2U7_18*	F2U7_2	F2U7_3*	F2U7_4	F2U7_5*	F2U7_6	F2U7_7*	F2U7_9*)(F2U10_1	F2U10_11	F2U10_19	F2U10_16	F2U10_17*	F2U10_24*	F2U10_21	F2U10_25*	F2U10_26*	F2U10_2	F2U10_3*	F2U10_6	F2U10_7*	F2U10_8	F2U10_20*	F2U10_10*)

rename (F3U7_1	F3U7_10	F3U7_12	F3U7_13	F3U7_14*	F3U7_15*	F3U7_16	F3U7_17*	F3U7_18*	F3U7_2	F3U7_3*	F3U7_4	F3U7_5*	F3U7_6	F3U7_7*	F3U7_9*)(F3U10_1	F3U10_11	F3U10_19	F3U10_16	F3U10_17*	F3U10_24*	F3U10_21	F3U10_25*	F3U10_26*	F3U10_2	F3U10_3*	F3U10_6	F3U10_7*	F3U10_8	F3U10_20*	F3U10_10*)

rename (F1U1_12*	F1U6_1	F1U6_10	F1U6_11*	F1U6_12*	F1U6_13	F1U6_14	F1U6_14_8_TEXT	F1U6_15	F1U6_16*	F1U6_3*	F1U6_4*	F1U6_5*	F1U6_6	F1U6_7	F1U6_8*	F1U6_9*)(F1U3_2*	F1U7_1	F1U7_18	F1U7_19*	F1U7_13*	F1U7_14	F1U7_15	F1U7_15_8_TEXT	F1U7_16	F1U7_22*	F1U7_2*	F1U7_3*	F1U3_18*	F1U7_6	F1U7_7	F1U7_8*	F1U7_17*)

rename (F2U1_12*	F2U6_1	F2U6_10	F2U6_11*	F2U6_12*	F2U6_13	F2U6_14	F2U6_14_8_TEXT	F2U6_15	  F2U6_3*	F2U6_4*	F2U6_5*	F2U6_6	F2U6_7	F2U6_8*	F2U6_9*)(F2U3_2*	F2U7_1	F2U7_18	F2U7_19*	F2U7_13*	F2U7_14	F2U7_15	F2U7_15_8_TEXT	F2U7_16		F2U7_2*	F2U7_3*	F2U3_18*	F2U7_6	F2U7_7	F2U7_8*	F2U7_17*)

rename (F3U6_1	F3U6_10	F3U6_11*	F3U6_12*	F3U6_13	F3U6_14	F3U6_14_8_TEXT	F3U6_15	F3U6_16*	F3U6_3* 	F3U6_4	F3U6_4_14_TEXT	F3U6_5*	F3U6_6	F3U6_7	F3U6_8*	F3U6_9*)(F3U7_1	F3U7_18	F3U7_19*	F3U7_13*	F3U7_14	F3U7_15	F3U7_15_8_TEXT	F3U7_16	F3U7_22*	F3U7_2*	F3U7_3 F3U7_3_11_TEXT F3U3_18*	F3U7_6	F3U7_7	F3U7_8*	F3U7_17*)

rename (YE1_1 YE2_8 YE2_9 YE3_7 YE7_1 YE9_1) (F4U1_1 F4U8_1 F4U8_2 F4U4_1 F4U8_4 F4U7_1)

rename (YE7_4 YE7_5 YE7_8 YE7_11 YE7_12 YE7_13 YE8_13 YE8_14 YE8_15) (F4U8_9 F4U8_10 F4U8_14 F4U8_17 F4U8_18 F4U8_19 F4U9_13 F4U9_14 F4U9_15) 


rename (YS* F1U* F2U* F3U* F4U*) (YSYS* F1UYS* F2UYS* F3UYS* F4UYS*)


foreach var of varlist _all {
   capture assert mi(`var')
   if !_rc {
       drop `var'
   }
}

quietly reshape long @YS_ResponseId @YS_LocationLatitude @YS_LocationLongitude @YS_StartDate @YS_EndDate @YS_RecordedDate @YS_duration @YSstatus @YS1_1 @YS1_3 @YS2_9_1 @YS2_9_8 @YS2_9_2 @YS2_10_1_1 @YS2_10_2_1 @YS2_10_3_1 @YS1_2 @YS8_1 @YS8_2 @YS8_5 @YS8_5_9_TEXT @YS8_3 @YS8_3_13_TEXT @YS8_3_14_TEXT @YS8_4 @YS8_4_8_TEXT @YS8_9 @YS8_10 @YS8_11 @YS8_13 @YS8_13_7_TEXT @YS8_14 @YS8_14_7_TEXT @YS8_17 @YS8_18 @YS8_19 @YS8_20 @YS8_21 @YS8_22 @YS8_23 @YS8_24 @YS8_25 @YS8_27 @YS8_28 @YS8_33 @YS8_34_1 @YS8_34_2 @YS8_34_3 @YS8_34_4 @YS8_34_5 @YS8_34_6 @YS8_34_7 @YS8_34_8 @YS8_34_8_TEXT @YS8_35 @YS8_36 @YS8_36_9_TEXT @YS4_1 @YS4_2 @YS4_2_4_TEXT @YS4_3 @YS4_3_6_TEXT @YS4_4 @YS4_5 @YS4_8_1 @YS4_8_2 @YS4_8_3 @YS4_8_4 @YS4_8_5 @YS4_8_6 @YS4_8_7 @YS4_8_8 @YS4_8_9 @YS4_8_9_TEXT @YS4_10 @YS4_11 @YS4_12 @YS4_15 @YS4_28_1 @YS4_28_2 @YS4_28_3 @YS4_28_4 @YS4_28_5 @YS4_28_6 @YS4_28_6_TEXT @YS4_36_1 @YS4_36_2 @YS4_36_3 @YS4_36_4 @YS4_36_5 @YS4_36_6 @YS4_36_0 @YS4_36_6_TEXT @YS4_37_1 @YS4_37_2 @YS4_37_3 @YS4_37_4 @YS4_37_5 @YS4_37_0 @YS4_38 @YS4_41 @YS4_42_1 @YS4_42_2 @YS4_42_3 @YS4_42_4 @YS4_42_5 @YS4_42_6 @YS4_42_7 @YS4_42_7_TEXT @YS4_47 @YS4_47_13_TEXT @YS4_43 @YS4_44 @YS4_51 @YS4_52_1 @YS4_52_2 @YS4_52_3 @YS4_52_4 @YS4_52_5 @YS4_52_6 @YS4_52_7 @YS4_52_8 @YS4_52_9 @YS4_52_9_TEXT @YS4_53 @YS4_53_8_TEXT @YS6_19 @YS6_21 @YS6_16_1 @YS6_16_2 @YS6_16_3 @YS6_16_4 @YS6_16_5 @YS6_16_6 @YS6_16_7 @YS9_1 @YS9_4 @YS9_4_7_TEXT @YS9_6 @YS9_6_10_TEXT @YS9_7 @YS9_8_1 @YS9_8_2 @YS9_8_3 @YS9_8_4 @YS9_8_5 @YS9_8_6 @YS9_9_1 @YS9_9_2 @YS9_9_3 @YS9_9_4 @YS9_9_5 @YS9_9_0 @YS9_9_5_TEXT @YS9_11_1 @YS9_11_2 @YS9_11_3 @YS9_11_4 @YS9_11_5 @YS9_11_5_TEXT @YS9_12 @YS9_13 @YS9_14 @YS9_15 @YS9_24 @YS9_23 @YS9_29_1 @YS9_29_2 @YS9_29_3 @YS9_29_4 @YS9_29_5 @YS9_29_6 @YS9_31 @YS9_33 @YS9_36 @YS9_34 @YS9_35_1 @YS9_35_2 @YS9_35_3 @YS9_35_4 @YS9_35_5 @YS9_35_6 @YS9_35_7 @YS9_35_7_TEXT @YS9_37 @YS9_37_6_TEXT @YS10_1 @YS10_2 @YS10_3 @YS10_3_8_TEXT @YS10_6 @YS10_7 @YS10_7_10_TEXT @YS10_8 @YS10_20 @YS10_20_6_TEXT @YS10_15_1 @YS10_15_2 @YS10_15_3 @YS10_15_4 @YS10_15_5 @YS10_15_6 @YS10_15_7 @YS10_15_8 @YS10_15_9 @YS10_15_10 @YS10_15_11 @YS10_15_12 @YS10_15_13 @YS10_15_14 @YS10_15_0 @YS10_15_14_TEXT @YS10_10_1 @YS10_10_2 @YS10_10_3 @YS10_10_4 @YS10_10_5 @YS10_10_6 @YS10_10_7 @YS10_10_8 @YS10_10_9 @YS10_10_10 @YS10_10_11 @YS10_10_11_TEXT @YS10_11 @YS10_12 @YS10_19 @YS10_16 @YS10_17_1 @YS10_17_2 @YS10_17_3 @YS10_17_4 @YS10_17_5 @YS10_17_6 @YS10_17_7 @YS10_17_8 @YS10_17_9 @YS10_17_10 @YS10_17_11 @YS10_17_11_TEXT @YS10_24 @YS10_24_16_TEXT @YS10_21 @YS10_25 @YS10_25_9_TEXT @YS10_26 @YS10_26_9_TEXT @YS10_27 @YS10_27_7_TEXT @YS7_1 @YS7_2 @YS7_2_9_TEXT @YS7_3 @YS7_3_11_TEXT @YS3_2_1 @YS3_2_2 @YS3_18_1 @YS3_18_2 @YS3_18_3 @YS3_7 @YS3_13 @YS3_18_4 @YS3_18_5 @YS3_18_6 @YS3_18_7 @YS3_18_8 @YS3_18_9 @YS3_18_9_TEXT @YS7_6 @YS7_7 @YS7_8_1 @YS7_8_2 @YS7_8_3 @YS7_8_4 @YS7_8_5 @YS7_8_6 @YS7_8_7 @YS7_8_8 @YS7_8_8_TEXT @YS7_13_0 @YS7_13_1 @YS7_13_2 @YS7_13_3 @YS7_13_4 @YS7_13_5 @YS7_13_5_TEXT @YS7_14 @YS7_15 @YS7_15_8_TEXT @YS7_16 @YS7_17_1 @YS7_17_2 @YS7_17_3 @YS7_17_4 @YS7_17_5 @YS7_17_6 @YS7_17_7 @YS7_17_8 @YS7_17_9 @YS7_17_9_TEXT @YS7_18 @YS7_19_1 @YS7_19_2 @YS7_19_3 @YS7_19_4 @YS7_19_5 @YS7_19_6 @YS7_19_6_TEXT @YS7_22 @YS7_22_8_TEXT, i(IDYouth) j(x YS F1U F2U F3U F4U)

// reorder wave variable
label define wavelbl 0 YS 1 F1U 2 F2U 3 F3U 4 F4U
encode x, generate(wave)
recode wave (5 = 0)
label values wave wavelbl
drop x

// reapply value labels

foreach s of global varlist {
    foreach v of var `s' {
        label var `v' "`var_lbl`s''"
    }
}

foreach v of local vallist{
label val `v' `v'
}

label var wave "Survey wave"

rename (YSYS* F1UYS* F2UYS* F3UYS*) (YS* F1U* F2U* F3U*)

rename (F2U4_36_7 F1U4_2_suivi YS_ResponseId YS_LocationLatitude YS_LocationLongitude YS_StartDate YS_EndDate YS_RecordedDate YS_duration YSstatus) (F2U2_14_7 F1U4_2 ResponseId LocationLatitude LocationLongitude StartDate EndDate RecordedDate duration status)

gen age = floor((StartDate - birthdate) / 365)
label var age "Age when interviewed"

gen birthyear = year(birthdate)
label var birthdate "Date of birth"

// if day or month unknown, use year of survey minus birth year as approximation
replace age = 2019-birthyear if YS2_10_1_1 == 99 | YS2_10_2_1 == 999 & (wave == 0 | wave == 1)
replace age = 2020-birthyear if YS2_10_1_1 == 99 | YS2_10_2_1 == 999 & (wave == 2 | wave == 3)

drop birthyear

*order _all, sequential
order wave IDYouth IDPatron cqp baseline_age baseline_activity age birthdate ResponseId LocationLatitude LocationLongitude StartDate EndDate RecordedDate duration YS* F1U* F2U* COV* F3U* 

// remove skills questions, personal identifiers like phone number, and other unneeded vars

drop YS5* YS2_2 YS2_3 YS2_4_0 YS2_4_1 YS2_4_1_TEXT YS2_4_2 YS2_4_2_TEXT YS2_5_0 YS2_5_1 YS2_5_1_TEXT YS2_5_2 YS2_5_2_TEXT YS2_6_0 YS2_6_1 YS2_6_1_TEXT YS2_7 YS2_8 YS2_8_5_TEXT YS2_2 YS2_3 YS2_4_1 YS2_4_2 YS2_4_0 YS2_4_1_TEXT YS2_4_2_TEXT YS2_5_1 YS2_5_2 YS2_5_0 YS2_5_1_TEXT YS2_5_2_TEXT YS2_6_1 YS2_6_0 YS2_6_1_TEXT YS2_7 YS2_8 YS2_8_5_TEXT F1U1_4 F1U1_5 F1U1_6 F1U1_7 F1U1_8 F2U1_4 F2U1_5 F2U1_6 F2U1_7 F2U1_8 F2U1_8a F2U1_8b F2U1_9_1 F2U1_9_8 F3U1_4 F3U1_5 F3U1_6 F3U1_7 F3U1_8 F3U1_8a F3U1_8b F3U1_9_1 F3U1_9_8 DEPART DIPLOME DOMICILEPATRON ENQUETEUR METIER_CORRIGE NApprenti NEnqueteur OBSERVATION PHONE1ATELIER PHONE1PATRON PHONE2ATELIER PHONE2PATRON PHONEAPPRENTI PHONEMERE PHONEPERE SEXE_APPRENTI

*remove all observations for questions which were not asked in subsequent waves

unab ys: YS2* YS4* YS6* YS7* YS8* YS9* YS10*
local nowave : list ys - global varlist

foreach v of local nowave {
	capture confirm numeric variable `v'
	if !_rc {
    quietly replace `v' = . if wave != 0
	}
	capture confirm str# variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != 0
	}
	capture confirm strL variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != 0
	}
}

forvalues i=1/3 {
	unab f`i'u: F`i'U*
  foreach v of local f`i'u {
	capture confirm numeric variable `v'
	if !_rc {
    quietly replace `v' = . if wave != `i'
	}
	capture confirm str# variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != `i'
	}
	capture confirm strL variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != `i'
	}
  }
}

unab cov: COV*
foreach v of local cov {
	capture confirm numeric variable `v'
	if !_rc {
    quietly replace `v' = . if wave != 0
	}
	capture confirm str# variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != 0
	}
	capture confirm strL variable `v'
	if !_rc {
    quietly replace `v' = "" if wave != 0
	}
}

 save youth_survey_reshaped, replace
